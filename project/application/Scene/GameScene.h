#pragma once
#include "Audio.h"
#include "BaseScene.h"
#include "GameBase.h"
#include "Light/DirectionalLight.h"
#include "Light/PointLight.h"
#include "Light/SpotLight.h"
#include "Object/House/House.h"
#include "Object/MapchipField.h"
#include "Object3d/Object3d.h"
#include "Particles/Particles.h"
#include "Pause/Pause.h"
#include "SceneTransition/SceneTransition.h"
#include "Sprite.h"
#include "UIManager.h"
#include "Vector2.h"
#include <array>
#include <cstdint>
#include <imgui.h>
#include <string>
    class Player;
class Enemy;
class CameraController;
class SkyDome;
class EnemyManager;


class GameScene: public BaseScene{


	private:
		


	bool IsPKey = false;
	bool IsXButton = false;
	bool IsKeyboard = true;

	uint32_t color;
	std::unique_ptr<Particles> particles;
	std::unique_ptr<UIManager> uimanager;
	std::unique_ptr<SceneTransition> sceneTransition;
	std::unique_ptr<Player> player;
	std::unique_ptr<EnemyManager> enemyManager;
	std::unique_ptr<SkyDome> skyDome;
	std::unique_ptr<CameraController> cameraController;
	std::unique_ptr<MapchipField> field;
	std::unique_ptr<House> house;
	std::unique_ptr<Pause> pause;

	bool isTransitionIn = true;
	bool isTransitionOut = false;
	std::string nextSceneName;
	bool isBGMPlaying = false;
	bool isPause = false;
			
	SoundData BGMData;

	// レベルアップ選択専用スプライト
	std::unique_ptr<Sprite> levelupIcons[4]; // 0:Atk, 1:Speed, 2:HP, 3:Allow
	std::unique_ptr<Sprite> phaseSprites_[5];
	int currentPhaseSpriteIndex_ = 0;
	int lastWave_ = 0;
	bool isPhaseSpriteActive_ = false;
	bool isPhaseSpritePaused_ = false;
	float phaseSpriteX_ = 0.0f;
	float phaseSpriteStopTimer_ = 0.0f;
	Vector2 phaseSpriteSize_ = {400.0f, 120.0f};
	float phaseSpriteY_ = 80.0f;

    
	DirectionalLight directionalLight_{};
	std::array<PointLight, kMaxPointLights> pointLights_{};
	uint32_t activePointLightCount_ = 0;
	std::array<SpotLight, kMaxSpotLights> spotLights_{};
	uint32_t activeSpotLightCount_ = 0;
	
	bool goalActive = false; // 敵全滅後に true になる

	bool sceneEndClear = false;
	bool sceneEndOver = false;
	// =====================
	// レベルアップ選択用
	// =====================
	bool isLevelSelecting = false;
	int selectChoices[2]; // 0:Atk, 1:Speed, 2:HP, 3:Allow
	int cursorIndex = 0;  // 0 or 1

	public:

	GameScene();
	~GameScene() override;

	void Initialize() override;
	void Update() override;
	void Draw() override;
	void Finalize() override;

	void DebugImGui();

	
};
